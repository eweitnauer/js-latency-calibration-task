<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8">

<title>JS Latency Estimation</title>
<meta name="author" content="Graspable, Inc.">

<link rel="stylesheet" href="styles.css">

</head>

<body>

<div id="container">
	<div id="track"></div>
</div>

<script>

function px(str) { return str + 'px'; }

var container = document.querySelector('#container');

var track = document.querySelector('#track')
  , t_dims = track.getBoundingClientRect();

var settings = { 'border-width': Math.max(t_dims.width/10, 15)
               , 'pacer-scale-factor': 1 };
var pacer_r = (settings['border-width'] * settings['pacer-scale-factor'])/2;

// The width of the track is a percentage of the page width. The height in the
// t_dims object will not accurately represent the height of the track.
track.style.height = px(t_dims.width);
track.style['border-width'] = px(settings['border-width']);

// The width of the track includes the width of the border.
var radius = t_dims.width/2
  , center = [t_dims.left + radius, t_dims.top + radius];
var rotations_per_second = 0.25;

var pacer = createPacer(getPositionOnTrack(0));
document.addEventListener("mousemove", function(event) {
	var radians = Math.atan2(event.pageY-center[1], event.pageX-center[0]);
	setPosOfPacer(pacer, radians);
});

// Use these lines to animate a pacer moving around the track.
// var pacer = createPacer(getPositionOnTrack(0));
// window.requestAnimationFrame(step);

function setPosOfPacer(pacer, radians) {
	var pos = getPositionOnTrack(radians);
	pacer.style.left = px(pos[0]);
	pacer.style.top = px(pos[1]);
}

function step(timestamp) {
	var seconds_elapsed = timestamp/1000;
	theta = 2*Math.PI*rotations_per_second*seconds_elapsed;
	setPosOfPacer(pacer, theta);
	window.requestAnimationFrame(step);
}

function getPositionOnTrack(radians) {
	var pos = getRadialPos(center, radius, radians);
	return [ pos[0] - pacer_r
	       , pos[1] - pacer_r ];
}

// The position returned will be midway through the track border.
function getRadialPos(center, radius, radians) {
	return [ center[0] + (radius-settings['border-width']/2)*Math.cos(radians)
	       , center[1] + (radius-settings['border-width']/2)*Math.sin(radians) ];
}

// Pacers are appended to the body of the document and positioned absolutely.
function createPacer(pos) {
	var pacer = document.createElement('div');
	pacer.className = 'pacer';
	pacer.style.width = px(2*pacer_r);
	pacer.style.height = px(2*pacer_r);
	pacer.style.left = px(pos[0]);
	pacer.style.top = px(pos[1]);
	document.body.appendChild(pacer);
	return pacer;
}

function coordinateDemo() {
	createPacer(getPositionOnTrack(0));
	createPacer(getPositionOnTrack(Math.PI/2));
	createPacer(getPositionOnTrack(Math.PI));
	createPacer(getPositionOnTrack(3*Math.PI/2));
}
</script>
</body>
</html>
